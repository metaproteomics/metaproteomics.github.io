---
import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";
import Sectionhead from "@components/sectionhead.astro";
import labsData from "../data/labs.json";

const countries = labsData.countries || [];
const totalLabs = countries.reduce((sum, c) => sum + (c.labs?.length || 0), 0);
const totalCountries = countries.length;
---

<Layout title="groups">
  <Container>
    <Sectionhead>
      <Fragment slot="title">Research Groups</Fragment>
      <Fragment slot="desc">
        The members of the Metaproteomics Initiative.
      </Fragment>
    </Sectionhead>

    <div class="flex flex-col gap-3 mx-auto max-w-4xl mt-16"> 
      <p class="text-lg leading-relaxed text-slate-500">
        This page lists all laboratories that joined the Metaproteomics
        Initiative. Currently, {totalLabs} labs in {totalCountries} countries joined.
      </p>
      <p class="text-lg leading-relaxed text-slate-500">
        Want your lab on this list? Become a member and add your lab <a
          href="https://docs.google.com/forms/d/e/1FAIpQLSdZUBIRB1QzDkcyzA1H1PWCUmucne3JVWcBwPucNzUGDTDFXQ/viewform"
          class="font-medium hover:underline">here</a
        >!
      </p>
    </div>

    <div class="grid md:grid-cols-1 gap-1 mx-auto max-w-4xl mt-8">
      {countries.map((c) => (
        <Fragment>
          <h2 class="font-medium text-2xl text-gray-800">{c.country}</h2>
          <ul class="list-disc list-inside mb-8 leading-relaxed">
            {c.labs && c.labs.map((lab) => {
              const hasWebsite = !!(lab.website && lab.website.trim());
              const place = [lab.institute, lab.city].filter(Boolean).join(", ");
              return (
                <li>
                  {hasWebsite ? (
                    <a class="font-medium hover:underline" href={lab.website}>{lab.name}</a>
                  ) : (
                    <span class="font-medium">{lab.name}</span>
                  )}
                  {place ? (
                    <> ({place})</>
                  ) : null}
                  {lab.groupLeader ? (
                    <> , led by {lab.groupLeader}</>
                  ) : null}
                </li>
              );
            })}
          </ul>
        </Fragment>
      ))}
    </div>
  </Container>
</Layout>
